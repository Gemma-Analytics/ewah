---

base_config: # applied to all DAGs unless overwritten
  dwh_engine: postgres
  dwh_conn_id: dwh
  airflow_conn_id: airflow
  start_date: 2020-10-01 00:00:00+00:00
  schedule_interval: !!python/object/apply:datetime.timedelta
    - 1 # days
    - 0 # seconds
  schedule_interval_backfill: !!python/object/apply:datetime.timedelta
    - 7
  schedule_interval_future: !!python/object/apply:datetime.timedelta
    - 0
    - 3600
  # For fullcremental loads
  schedule_interval_full_refresh: !!python/object/apply:datetime.timedelta
    - 1 # days
    - 0 # seconds
  schedule_interval_incremental: !!python/object/apply:datetime.timedelta
    - 0 # days
    - 3600 # seconds
  additional_task_args:
    retries: 1
    retry_delay: !!python/object/apply:datetime.timedelta
      - 0
      - 30
    email_on_retry: False
    email_on_failure: False
    # email: ['me+ewahairflowerror@mail.com']
el_dags:

  EL_BigQuery:
    incremental: False
    el_operator: bq
    target_schema_name: raw_bq
    operator_config:
      general_config:
        source_conn_id: bq
        source_schema_name: ds1
      tables:
        weights:
          source_table_name: bijan_weight

  EL_Facebook: !yml_from_file secret_dag_facebook.yml

  EL_FX:
    incremental: False
    el_operator: fx
    target_schema_name: raw_fx
    operator_config:
      general_config:
        frequency: daily
        data_from: 2016-12-01 00:00:00+00:00
      tables:
        daily_fx_rates_usd_eur:
          currency_pair: ['USD', 'EUR']
        daily_fx_rates_usd_cad:
          currency_pair: ['USD', 'CAD']
        daily_fx_rates_usd_gbp:
          currency_pair: ['USD', 'GBP']
        daily_fx_rates_usd_chf:
          currency_pair: ['USD', 'CHF']

  # EL_GAds: tbd

  EL_GA: !yml_from_file secret_dag_google_analytics.yml

  # EL_GMaps: tbd

  # EL_GSheets: tbd

  EL_Hubspot:
    incremental: False
    el_operator: hubspot
    target_schema_name: raw_hubspot
    operator_config:
      general_config:
        source_conn_id: hubspot
      tables:
        companies: {}
        contacts:
          properties:
            - new_ip_address
            - new_referer
            - new_user_agent
            - new_utm_campaign
            - new_utm_content
        deals: {}
        feedback_submissions: {}
        line_items: {}
        products: {}
        tickets: {}
        quotes_table:
          object: quotes

  EL_Mailchimp:
    incremental: False
    el_operator: mailchimp
    target_schema_name: raw_mailchimp
    dwh_conn_id: ssh_dwh
    dwh_ssh_tunnel_conn_id: ssh_target
    operator_config:
      general_config:
        source_conn_id: mailchimp
      tables:
        reports:
          resource: reports
        lists:
          resource: lists
        lists_hashed:
          resource: lists
          hash_columns: name
        conversations:
          resource: conversations
        campaigns: {}
        campaigns_hashed:
          resource: campaigns
          hash_columns:
            - web_id
            - type
            - status
            - sed_time

  EL_Mailingwork:
    incremental: False
    el_operator: mailingwork
    target_schema_name: raw_mailingwork
    operator_config:
      general_config:
        source_conn_id: mailingwork
      tables:
        fields:
          endpoint: getfields
        lists:
          endpoint: getlists
        mailings:
          endpoint: getmailings
        media:
          endpoint: getmedia
        export_recipients:
          endpoint: exportrecipients
          iter_param:
            name: listId
            values:
              - 241
              - 239
              - 237
              - 235
              - 233
              - 231
              - 229
              - 227
              - 225
              - 223
              - 221
              - 219
              - 217
              - 211
              - 209
              - 205
              - 203
              - 201
              - 199
              - 197
              - 195
              - 193
              - 191
              - 189
              - 187
              - 185
              - 183
              - 181
              - 179
              - 177
              - 175
              - 173
              - 171
              - 169
              - 167
              - 165
              - 163
              - 161
              - 159
              - 157
              - 155
              - 153
              - 151
              - 149
              - 147
              - 145
              - 143
              - 119
              - 117
              - 115
              - 113
              - 111
              - 107
              - 105
              - 103
              - 101
              - 99
              - 97
              - 95
              - 93
              - 91
              - 89
              - 87
              - 71
              - 61
              - 59
              - 19
              - 14
              - 13
              - 10
              - 8
              - 7
              - 6
              - 5
              - 3
              - 2

  EL_MongoDB: !yml_from_file secret_dag_mongodb.yml
  EL_MongoDB_2: !yml_from_file secret_dag_mongodb_2.yml

  EL_MySQL_Shopware:
    incremental: False
    el_operator: mysql
    target_schema_name: raw_shopware
    #dwh_conn_id: ssh_dwh
    #dwh_ssh_tunnel_conn_id: ssh_target
    operator_config:
      general_config:
        source_conn_id: shopware
        source_schema_name: shopware
        source_ssh_tunnel_conn_id: ssh_tunnel
        primary_key_column_name: id
        chunking_interval: 100000
      tables:
        s_articles: {}
        s_articles_categories_seo: {}

  EL_Oracle: !yml_from_file secret_dag_oracle_to_snowflake.yml
  EL_Oracle_2: !yml_from_file secret_dag_oracle_fullcremental.yml

  # EL_Postgres: tbd

  EL_S3: !yml_from_file secret_dag_s3.yml

  # EL_Shopify: tbd

  EL_Stripe:
    incremental: False
    el_operator: stripe
    target_schema_name: raw_stripe
    operator_config:
      general_config:
        source_conn_id: stripe
      tables:
        Account: {}
        Balance: {} # resource defaults to table name
        balance_transactions:
          resource: BalanceTransaction
        Customer: {}
        Payout: {}
        Charge:
          expand: # expand a list of strings as required
            - 'data.customer'
        products:
          resource: Product
        refunds:
          resource: Refund

  # EL_Zendesk: tbd

...
